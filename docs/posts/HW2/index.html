<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emil Blaignan">
<meta name="dcterms.date" content="2025-02-08">

<title>Data-Driven Movie Recommendations: Scrapy Web Scraping and Actor Network Graphs with NetworkX – Emil Blaignan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Emil Blaignan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../personal.html"> 
<span class="menu-text">Personal</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/emilblaignan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/emil-blaignan/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Data-Driven Movie Recommendations: Scrapy Web Scraping and Actor Network Graphs with NetworkX</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Week 5</div>
                <div class="quarto-category">HW2</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Emil Blaignan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 8, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setting-up-the-webscraper" id="toc-setting-up-the-webscraper" class="nav-link" data-scroll-target="#setting-up-the-webscraper">Setting Up the Webscraper</a>
  <ul class="collapse">
  <li><a href="#initializing-the-scrapy-project" id="toc-initializing-the-scrapy-project" class="nav-link" data-scroll-target="#initializing-the-scrapy-project">Initializing the Scrapy Project</a></li>
  <li><a href="#understanding-the-tmdb-website-structure" id="toc-understanding-the-tmdb-website-structure" class="nav-link" data-scroll-target="#understanding-the-tmdb-website-structure">Understanding the TMDB Website Structure</a></li>
  <li><a href="#configuring-the-scrapy-crawler-settings" id="toc-configuring-the-scrapy-crawler-settings" class="nav-link" data-scroll-target="#configuring-the-scrapy-crawler-settings">Configuring the Scrapy Crawler Settings</a></li>
  </ul></li>
  <li><a href="#building-the-scrapy-spider" id="toc-building-the-scrapy-spider" class="nav-link" data-scroll-target="#building-the-scrapy-spider">Building the Scrapy Spider</a>
  <ul class="collapse">
  <li><a href="#navigating-to-the-cast-crew-page" id="toc-navigating-to-the-cast-crew-page" class="nav-link" data-scroll-target="#navigating-to-the-cast-crew-page">Navigating to the Cast &amp; Crew Page</a></li>
  <li><a href="#extracting-actor-links" id="toc-extracting-actor-links" class="nav-link" data-scroll-target="#extracting-actor-links">Extracting Actor Links</a></li>
  <li><a href="#extracting-movie-and-tv-show-titles" id="toc-extracting-movie-and-tv-show-titles" class="nav-link" data-scroll-target="#extracting-movie-and-tv-show-titles">Extracting Movie and TV Show Titles</a></li>
  <li><a href="#running-the-scraper" id="toc-running-the-scraper" class="nav-link" data-scroll-target="#running-the-scraper">Running the Scraper</a></li>
  </ul></li>
  <li><a href="#visualizing-movie-recommendations" id="toc-visualizing-movie-recommendations" class="nav-link" data-scroll-target="#visualizing-movie-recommendations">Visualizing Movie Recommendations</a>
  <ul class="collapse">
  <li><a href="#processing-the-scraped-data" id="toc-processing-the-scraped-data" class="nav-link" data-scroll-target="#processing-the-scraped-data">Processing the Scraped Data</a></li>
  <li><a href="#building-the-network-graph" id="toc-building-the-network-graph" class="nav-link" data-scroll-target="#building-the-network-graph">Building the Network Graph</a></li>
  <li><a href="#deploying-the-movie-network-graph" id="toc-deploying-the-movie-network-graph" class="nav-link" data-scroll-target="#deploying-the-movie-network-graph">Deploying the Movie Network Graph</a></li>
  <li><a href="#interpretting-the-visualization" id="toc-interpretting-the-visualization" class="nav-link" data-scroll-target="#interpretting-the-visualization">Interpretting the Visualization</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="NetworkGraph.png" class="img-fluid figure-img"></p>
<figcaption>Network Graph of Movie Data</figcaption>
</figure>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The TMDB (The Movie Database) is a comprehensive online database that provides detailed information on movies, TV shows, actors, and production crews. In this project, we will develop a Scrapy-based web crawler to extract movie and actor data from TMDB. The crawler is designed to navigate from a movie’s main page to its full cast list, retrieve actor profiles, and extract their filmographies. We will employ CSS selectors for precise data extraction, implement depth-controlled crawling to avoid unnecessary requests, and optimize request handling to improve performance. Finally, we will use the extracted data to identify patterns in shared actor collaborations across movies using NetworkX. Through this approach, we demonstrate how Scrapy can be leveraged to build a structured dataset for analyzing relationships within the film industry.</p>
</section>
<section id="setting-up-the-webscraper" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-webscraper">Setting Up the Webscraper</h2>
<p>In this section, we’ll first initialize the Scrapy framework, examine how TMDB organizes its data, and prepare our project for extracting meaningful movie-actor relationships.</p>
<section id="initializing-the-scrapy-project" class="level3">
<h3 class="anchored" data-anchor-id="initializing-the-scrapy-project">Initializing the Scrapy Project</h3>
<p>We’ll start by creating a new Scrapy project.</p>
<p>We can do this by opening the terminal and activating the relevant Python environment:</p>
<div id="3e3892df-4447-446c-ac07-42644b6cd150" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>conda activate PIC16B<span class="op">-</span><span class="dv">25</span><span class="er">W</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, create a Scrapy project by running:</p>
<div id="49ccffec-eb68-4325-9030-939cb3fc7935" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>scrapy startproject TMDB_scraper</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cd TMDB_scraper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running this will create a folder named “TMDB_scraper” with the following contents inside:</p>
<div id="a3d83fb8-52e7-4c0f-8a74-7d6340fd5f01" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>TMDB_scraper<span class="op">/</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>│── scrapy.cfg                </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>└── TMDB_scraper<span class="op">/</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    ├── spiders<span class="op">/</span>              </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    │   └── tmdb_spider.py    <span class="co"># Our main spider script</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    ├── settings.py           <span class="co"># Scrapy settings file</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ├── middlewares.py        </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    ├── pipelines.py          </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    └── <span class="fu">__init__</span>.py           </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll only really need the <code>tmdb_spider.py</code> file, where we will write the logic for our scraper. We’ll also make minor changes to the setting of our spider in <code>settings.py</code>.</p>
</section>
<section id="understanding-the-tmdb-website-structure" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-tmdb-website-structure">Understanding the TMDB Website Structure</h3>
<p>In order to extract the correct data, we need to analyze how TMDB organizes and displays its information. A movie page typically exhibits the following structure:</p>
<p><strong>Movie Starting Page</strong><br> Once on a movie’s starting page, we observe that the URL contains a movie ID. Our project will focus on <em>Harry Potter and the Sorcerer’s Stone</em>. the TMDB URL for <em>Harry Potter and the Sorcerer’s Stone</em> is:</p>
<div id="7ec0a7e0-9d34-48d5-b76e-9ca4278716d7" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>https:<span class="op">//</span>www.themoviedb.org<span class="op">/</span>movie<span class="op">/</span><span class="dv">671</span><span class="op">-</span>harry<span class="op">-</span>potter<span class="op">-</span><span class="kw">and</span><span class="op">-</span>the<span class="op">-</span>philosopher<span class="op">-</span>s<span class="op">-</span>stone<span class="op">/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The movie ID <code>671-harry-potter-and-the-philosopher-s-stone</code> will be passed as an argument to our scraper.</p>
<p><strong>Navigate to the Cast &amp; Crew Page</strong><br> Next we want to click on the “Full Cast &amp; Crew” link which takes us to the following page:</p>
<div id="8410b391-5adf-4c39-a3be-3e4b4f4bd267" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>https:<span class="op">//</span>www.themoviedb.org<span class="op">/</span>movie<span class="op">/</span><span class="dv">671</span><span class="op">-</span>harry<span class="op">-</span>potter<span class="op">-</span><span class="kw">and</span><span class="op">-</span>the<span class="op">-</span>philosopher<span class="op">-</span>s<span class="op">-</span>stone<span class="op">/</span>cast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the URL is the same as the previous page, except for the <code>/cast</code> appended to the end. This page is where our spider will extract the list of actors (ignoring crew members).</p>
<p><strong>Extracting Actor Profiles</strong><br> Clicking on an actor’s name leads to the actor profile page:</p>
<div id="11f7d579-9a96-4743-95be-33ba1f22adad" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>https:<span class="op">//</span>www.themoviedb.org<span class="op">/</span>person<span class="op">/</span><span class="dv">10980</span><span class="op">-</span>daniel<span class="op">-</span>radcliffe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On this page, we need to find the “Acting” section, which contains a list of movies and TV shows the actor has performed in. There are multiple sections such as Production, Writing, and Acting. We must only extract movie titles listed under “Acting”.</p>
</section>
<section id="configuring-the-scrapy-crawler-settings" class="level3">
<h3 class="anchored" data-anchor-id="configuring-the-scrapy-crawler-settings">Configuring the Scrapy Crawler Settings</h3>
<p>To prevent excessive data requests while we are testing the crawler, we’ll temporarily add the following line in <code>settings.py</code>:</p>
<div id="dad6cbaa-9fa1-475f-8765-a1acaa93221b" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>CLOSESPIDER_PAGECOUNT <span class="op">=</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This stops the spider after 20 pages so we don’t accidentally send too many requests while debugging.</p>
<p>When scraping, we’ll look for the <code>200</code> status. If we run into the <code>403 Forbidden</code> error when TMDB detects that we’re a bot. A simple fix is changing the User-Agent in <code>settings.py</code>:</p>
<div id="3c61a7cd-46e3-47cd-b5ed-81deae618c69" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>USER_AGENT <span class="op">=</span> <span class="st">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This makes our scraper appear as a normal browser request, reducing the chance of being blocked.</p>
</section>
</section>
<section id="building-the-scrapy-spider" class="level2">
<h2 class="anchored" data-anchor-id="building-the-scrapy-spider">Building the Scrapy Spider</h2>
<p>Now that our Scrapy project is set up and we have analyzed TMDB website structure, we can implement the three parsing methods in our spider:</p>
<ol type="1">
<li><code>parse()</code>: Navigates from the movie page to the Full Cast &amp; Crew page.</li>
<li><code>parse_full_credits()</code>: Extracts the list of actors in the movie.</li>
<li><code>parse_actor_page()</code>: Extracts movies from the actor’s Acting section.</li>
</ol>
<p>Each of these methods will systematically extract the data we need. We’ll write them into the <code>tmdb_spider.py</code> file.</p>
<section id="navigating-to-the-cast-crew-page" class="level3">
<h3 class="anchored" data-anchor-id="navigating-to-the-cast-crew-page">Navigating to the Cast &amp; Crew Page</h3>
<p><strong>parse():</strong><br> The <code>parse()</code> method starts from a movie’s main page and navigates to its Full Cast &amp; Crew page. Since the cast page always follows the pattern <code>&lt;movie_url&gt;/cast</code>, we can simply append <code>/cast</code> to the current URL.</p>
<p>Implementation:</p>
<div id="0cf2f39b-0f82-44d4-9bc6-5abc81f0e81e" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(<span class="va">self</span>, response):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Navigates from the movie page to the Full Cast &amp; Crew page.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    cast_url <span class="op">=</span> response.url <span class="op">+</span> <span class="st">"/cast"</span> <span class="co"># Appends "/cast" to the end of the current URL.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creates a Scrapy request to Cast URL and calls parse_full_credits().</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> scrapy.Request(url<span class="op">=</span>cast_url, callback<span class="op">=</span><span class="va">self</span>.parse_full_credits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This method works by:</p>
<ul>
<li>Extracting the Full Cast &amp; Crew URL by appending “/cast” to the movie’s base URL.</li>
<li>Creating a Scrapy request to that URL and calling parse_full_credits() once the page is loaded.</li>
</ul>
<p>This method does not extract any data but ensures we reach the correct page for scraping actors.</p>
</section>
<section id="extracting-actor-links" class="level3">
<h3 class="anchored" data-anchor-id="extracting-actor-links">Extracting Actor Links</h3>
<p><strong>parse_full_credits():</strong><br> Once we reach the Full Cast &amp; Crew page, we need to extract only the actors listed in the cast section.</p>
<p>Implementation:</p>
<div id="52a25100-72b3-4509-a5c5-b804bdf1a64d" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_full_credits(<span class="va">self</span>, response):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Extracts actors from the Full Cast &amp; Crew page </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and yields requests for each actor’s page.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selects all actor profile links &lt;a&gt; elements </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inside the cast list &lt;ol class="people credits"&gt;.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracts the href attribute, which contains the link to the actor’s TMDB page.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    actor_links <span class="op">=</span> response.css(<span class="st">'ol.people.credits li[data-order] div.info a[href^="/person/"]::attr(href)'</span>).getall()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Yields a new request for each actor’s profile page, calling parse_actor_page().</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> link <span class="kw">in</span> actor_links:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> scrapy.Request(url<span class="op">=</span>response.urljoin(link), callback<span class="op">=</span><span class="va">self</span>.parse_actor_page)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This method works by:</p>
<ul>
<li>Selecting all actor profile links <code>&lt;a&gt;</code> elements inside the cast list <code>&lt;ol class="people credits"&gt;</code>.</li>
<li>Extracting the href attribute, containing the link to the actor’s TMDB page.</li>
<li>Yielding a new request for each actor’s profile page, calling <code>parse_actor_page()</code> for further processing.</li>
</ul>
<p>This method ensures that <strong>only actors (not crew members)</strong> are processed.</p>
</section>
<section id="extracting-movie-and-tv-show-titles" class="level3">
<h3 class="anchored" data-anchor-id="extracting-movie-and-tv-show-titles">Extracting Movie and TV Show Titles</h3>
<p><strong>parse_actor_page()</strong><br> On an actor’s TMDB page, movies and TV shows are categorized under multiple sections like Acting, Writing, Directing, and Producing. <strong>We must extract only titles under the “Acting” section.</strong></p>
<p>Implementation:</p>
<div id="1f81644d-d2cc-4c7a-bb82-7dbb0a6c025f" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_actor_page(<span class="va">self</span>, response):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">        Extracts actor's name and their acting roles, yielding unique movie/TV titles.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Selector extracts actor's name</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        actor_name <span class="op">=</span> response.css(<span class="st">"h2.title a::text"</span>).get()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Selector extracts section headers</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        section_headers <span class="op">=</span> response.css(<span class="st">"div.credits_list h3::text"</span>).getall()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Locates the "Acting" section</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        acting_index <span class="op">=</span> section_headers.index(<span class="st">"Acting"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get all tables and extract titles from the Acting section</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        all_tables <span class="op">=</span> response.css(<span class="st">"div.credits_list table.card"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        acting_table <span class="op">=</span> all_tables[acting_index]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        titles <span class="op">=</span> acting_table.css(<span class="st">"a.tooltip bdi::text"</span>).getall()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> movie_or_TV_name <span class="kw">in</span> titles:</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> {<span class="st">"actor"</span>: actor_name, <span class="st">"movie_or_TV_name"</span>: movie_or_TV_name}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This method works by:</p>
<ul>
<li>Extracting the actor’s name from the <code>&lt;h2 class="title"&gt;</code> section.</li>
<li>Finding all section headers (e.g., “Production”, “Acting”) to locate the Acting section.</li>
<li>Finding the matching table for “Acting” and extracting all movie/TV show titles inside.</li>
<li>Yielding a dictionary containing (actor, movie/TV show) pairs.</li>
</ul>
<p>This method ensures that only acting credits are included.</p>
</section>
<section id="running-the-scraper" class="level3">
<h3 class="anchored" data-anchor-id="running-the-scraper">Running the Scraper</h3>
<p>Before we run our scraper, we can check that our CSS selectors are working by running this in the terminal:</p>
<div id="a2908b39-dac4-4388-a22c-c143ec7ab38f" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>scrapy shell <span class="st">"your_page_link"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Within the shell for each page, we can run each selector in our three parse methods to see if it yields the desired output.</p>
<p>After checking our selectors, we are ready to run the scraper with the following line:</p>
<div id="e5dadc44-9877-41bb-ba8a-1a4c96cba05f" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>scrapy crawl tmdb_spider <span class="op">-</span>o results.csv <span class="op">-</span>a subdir<span class="op">=</span><span class="dv">671</span><span class="op">-</span>harry<span class="op">-</span>potter<span class="op">-</span><span class="kw">and</span><span class="op">-</span>the<span class="op">-</span>philosopher<span class="op">-</span>s<span class="op">-</span>stone</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This command will:</p>
<ol type="1">
<li>Start at the <em>Harry Potter and the Sorcerer’s Stone</em> movie page.</li>
<li>Extract all actors from the Full Cast &amp; Crew page.</li>
<li>Visit each actor’s profile and extract all movies in which they have acted.</li>
<li>Save the results in <code>results.csv</code>.</li>
</ol>
<p>Our CSV file should look like:</p>
<div id="c1e0cd88-ab28-42a8-afdd-65f9badbf5a4" class="cell" data-tags="[]" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">actor</th>
<th data-quarto-table-cell-role="th">movie_or_TV_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Paul Marc Davis</td>
<td>Arthur &amp; Merlin: Knights of Camelot</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Paul Marc Davis</td>
<td>Class</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Paul Marc Davis</td>
<td>Son of God</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Paul Marc Davis</td>
<td>The Bible</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Paul Marc Davis</td>
<td>The Sky in Bloom</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3121</td>
<td>Rupert Grint</td>
<td>The View</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3122</td>
<td>Rupert Grint</td>
<td>GMTV</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3123</td>
<td>Rupert Grint</td>
<td>The Tonight Show with Jay Leno</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3124</td>
<td>Rupert Grint</td>
<td>An Audience with...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3125</td>
<td>Rupert Grint</td>
<td>Today</td>
</tr>
</tbody>
</table>

<p>3126 rows × 2 columns</p>
</div>
</div>
</div>
<p>Now that we have successfully scraped the data, the next step is to analyze the results and create a visualization of shared actors across movies. In the next section, we will:</p>
<ul>
<li>Filter the data to find movies with the most shared actors.</li>
<li>Create a network graph to visually represent relationships between movies and actors.</li>
</ul>
</section>
</section>
<section id="visualizing-movie-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-movie-recommendations">Visualizing Movie Recommendations</h2>
<p>Once the scraper is complete, we need to analyze the results and present them in a meaningful way. Since our dataset consists of movies and actors, a network graph is an intuitive choice for visualization. A network graph allows us to see which movies share actors and how strongly they are connected.</p>
<section id="processing-the-scraped-data" class="level3">
<h3 class="anchored" data-anchor-id="processing-the-scraped-data">Processing the Scraped Data</h3>
<p>The CSV output from our Scrapy spider contains two columns:</p>
<ul>
<li>Actor: The name of the actor.</li>
<li>Movie or TV Show: The name of the movie or TV show they appeared in.</li>
</ul>
<p>To build a movie recommendation system, we’ll look for movies that share multiple actors by the following:</p>
<ol type="1">
<li>Grouping actors by movie: Create a mapping of each movie to the list of actors who starred in it.</li>
<li>Compute shared actors: Identify pairs of movies that share actors.</li>
<li>Filter based on shared actor count: We only include movies that share at least 5 actors in the final visualization.</li>
</ol>
</section>
<section id="building-the-network-graph" class="level3">
<h3 class="anchored" data-anchor-id="building-the-network-graph">Building the Network Graph</h3>
<p>We’ll use NetworkX to create a graph where:</p>
<ul>
<li>Nodes represent movies and actors.</li>
<li>Edges exist between a movie node and an actor node if the actor starred in the movie.</li>
<li>Movies with more shared actors are emphasized by larger node size and distinct colors.</li>
</ul>
<p>Additionally, in order to enhance readability, we’ll apply:</p>
<ul>
<li>Node scaling to make movies with more shared actors appear larger.</li>
<li>Color encoding to assign colors to movie nodes using a thermal colormap, where warmer colors (yellow) indicate more shared actors and cooler colors less.</li>
</ul>
</section>
<section id="deploying-the-movie-network-graph" class="level3">
<h3 class="anchored" data-anchor-id="deploying-the-movie-network-graph">Deploying the Movie Network Graph</h3>
<p>First, we’ll need to import the necessary packages to create our visualization:</p>
<div id="dbc1809f-d9d3-4fa3-973f-cd1c5eef0876" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we will write a function that will take our CSV file and a minimum number of shared actors per movie as inputs (only recommend movies and TV shows with high actor correlation).</p>
<p>The following function plots our interactive movie network graph with our desired specs:</p>
<div id="a1f72a31-2551-4ee2-9920-2f8a61174299" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_movie_actor_network(csv_file, min_shared_actors):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Generates a movie-actor network graph from a CSV file containing movie and actor relationships.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loads in the dataset</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(csv_file)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a graph</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build the mapping of movies to actors</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    movie_actor_map <span class="op">=</span> {}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        movie <span class="op">=</span> row[<span class="st">"movie_or_TV_name"</span>]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        actor <span class="op">=</span> row[<span class="st">"actor"</span>]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> movie <span class="kw">not</span> <span class="kw">in</span> movie_actor_map:</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>            movie_actor_map[movie] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        movie_actor_map[movie].add(actor)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify valid movies that share at least `min_shared_actors` actors with another movie</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    valid_movies <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> movie1 <span class="kw">in</span> movie_actor_map:</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> movie2 <span class="kw">in</span> movie_actor_map:</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> movie1 <span class="op">!=</span> movie2:</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                shared_actors <span class="op">=</span> movie_actor_map[movie1] <span class="op">&amp;</span> movie_actor_map[movie2]</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(shared_actors) <span class="op">&gt;=</span> min_shared_actors:</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                    valid_movies.add(movie1)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                    valid_movies.add(movie2)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the number of unique actors in each valid movie</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    movie_shared_counts <span class="op">=</span> {</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        movie: <span class="bu">len</span>(movie_actor_map[movie]) <span class="cf">for</span> movie <span class="kw">in</span> valid_movies</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    max_shared <span class="op">=</span> <span class="bu">max</span>(movie_shared_counts.values(), default<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Avoid division by zero</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize sizes (scale between 10 and 55 for visualization purposes)</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scale_size(value, min_size<span class="op">=</span><span class="dv">10</span>, max_size<span class="op">=</span><span class="dv">55</span>):</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> min_size <span class="op">+</span> ((value <span class="op">-</span> <span class="dv">3</span>) <span class="op">/</span> (max_shared <span class="op">-</span> <span class="dv">3</span>)) <span class="op">*</span> (max_size <span class="op">-</span> min_size) <span class="cf">if</span> max_shared <span class="op">&gt;</span> <span class="dv">3</span> <span class="cf">else</span> min_size</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign movie colors based on shared actor count using thermal color scale.</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    norm <span class="op">=</span> plt.Normalize(vmin<span class="op">=</span><span class="bu">min</span>(movie_shared_counts.values(), default<span class="op">=</span><span class="dv">0</span>), vmax<span class="op">=</span>max_shared)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    thermal_colormap <span class="op">=</span> plt.get_cmap(<span class="st">"viridis"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    movie_colors <span class="op">=</span> {</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        movie: <span class="ss">f'rgb(</span><span class="sc">{</span><span class="bu">int</span>(r<span class="op">*</span><span class="dv">255</span>)<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span><span class="bu">int</span>(g<span class="op">*</span><span class="dv">255</span>)<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span><span class="bu">int</span>(b<span class="op">*</span><span class="dv">255</span>)<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> movie, (r, g, b, _) <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>            movie_shared_counts.keys(),</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>            [thermal_colormap(norm(v)) <span class="cf">for</span> v <span class="kw">in</span> movie_shared_counts.values()]</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add nodes and edges to the graph</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> movie <span class="kw">in</span> valid_movies:</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>        G.add_node(movie, <span class="bu">type</span><span class="op">=</span><span class="st">"movie"</span>, size<span class="op">=</span>scale_size(movie_shared_counts[movie]), color<span class="op">=</span>movie_colors[movie])</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> movie <span class="kw">in</span> valid_movies:</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> actor <span class="kw">in</span> movie_actor_map[movie]:</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> actor <span class="kw">not</span> <span class="kw">in</span> G:</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>                G.add_node(actor, <span class="bu">type</span><span class="op">=</span><span class="st">"actor"</span>, size<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"lightgray"</span>)  <span class="co"># Smaller nodes for actors</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>            G.add_edge(movie, actor)</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute graph layout for better spacing</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> nx.spring_layout(G, seed<span class="op">=</span><span class="dv">42</span>, k<span class="op">=</span><span class="fl">1.7</span>)  <span class="co"># 'k' controls the node spacing</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create scatter plot for nodes</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    node_trace <span class="op">=</span> []</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> G.nodes():</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>        node_type <span class="op">=</span> G.nodes[node][<span class="st">"type"</span>]</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> pos[node]</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> G.nodes[node][<span class="st">"color"</span>]</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> G.nodes[node][<span class="st">"size"</span>]</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set hover text for nodes</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>        hover_text <span class="op">=</span> node <span class="cf">if</span> node_type <span class="op">==</span> <span class="st">"actor"</span> <span class="cf">else</span> <span class="ss">f"</span><span class="sc">{</span>node<span class="sc">}</span><span class="ss">&lt;br&gt;Shared Actors: </span><span class="sc">{</span>movie_shared_counts[node]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>        node_trace.append(go.Scatter(</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[x], y<span class="op">=</span>[y],</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>            mode<span class="op">=</span><span class="st">"markers"</span> <span class="cf">if</span> node_type <span class="op">==</span> <span class="st">"actor"</span> <span class="cf">else</span> <span class="st">"markers+text"</span>,</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span>size, color<span class="op">=</span>color, opacity<span class="op">=</span><span class="fl">0.9</span>, showscale<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>            hovertext<span class="op">=</span>hover_text,</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>            textposition<span class="op">=</span><span class="st">"top center"</span> <span class="cf">if</span> node_type <span class="op">==</span> <span class="st">"movie"</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create edges for connections between movies and actors</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    edge_trace <span class="op">=</span> []</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> edge <span class="kw">in</span> G.edges():</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>        x0, y0 <span class="op">=</span> pos[edge[<span class="dv">0</span>]]</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>        x1, y1 <span class="op">=</span> pos[edge[<span class="dv">1</span>]]</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>        edge_trace.append(go.Scatter(</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[x0, x1, <span class="va">None</span>], y<span class="op">=</span>[y0, y1, <span class="va">None</span>],</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>            mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>            line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>),</span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>            hoverinfo<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>            opacity<span class="op">=</span><span class="fl">0.2</span>  <span class="co"># Light transparency for better visibility</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a color bar to indicate shared actors</span></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>    colorbar_trace <span class="op">=</span> go.Scatter(</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[<span class="va">None</span>], y<span class="op">=</span>[<span class="va">None</span>],</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">'markers'</span>,</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>            colorscale<span class="op">=</span><span class="st">"viridis"</span>,  <span class="co"># Thermal color scheme</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>            cmin<span class="op">=</span><span class="bu">min</span>(movie_shared_counts.values(), default<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>            cmax<span class="op">=</span>max_shared,</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>            showscale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>            colorbar<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>                title<span class="op">=</span><span class="st">"# of Shared Actors"</span>,</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>                titleside<span class="op">=</span><span class="st">"right"</span>,  <span class="co"># Aligns title to the right</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>                tickmode<span class="op">=</span><span class="st">"array"</span>,</span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>                tickvals<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">int</span>(max_shared) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>                ticktext<span class="op">=</span>[<span class="bu">str</span>(tick) <span class="cf">for</span> tick <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">int</span>(max_shared) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">10</span>)],</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>                tickfont<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>),  </span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>                <span class="bu">len</span><span class="op">=</span><span class="dv">1</span>,  </span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>                thickness<span class="op">=</span><span class="dv">20</span>,  </span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>                outlinewidth<span class="op">=</span><span class="fl">1.3</span>,</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>                xpad<span class="op">=</span><span class="dv">6</span>,  </span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span><span class="fl">0.97</span>  </span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>        hoverinfo<span class="op">=</span><span class="st">'none'</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create final figure</span></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure(data<span class="op">=</span>edge_trace <span class="op">+</span> node_trace <span class="op">+</span> [colorbar_trace])</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span><span class="st">"Movie Recs: Movie-Actor Network Graph"</span>,</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.427</span>,  </span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>            yanchor<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>            font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">20</span>)  </span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>        showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>        hovermode<span class="op">=</span><span class="st">"closest"</span>,</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>        margin<span class="op">=</span><span class="bu">dict</span>(b<span class="op">=</span><span class="dv">20</span>, l<span class="op">=</span><span class="dv">5</span>, r<span class="op">=</span><span class="dv">140</span>, t<span class="op">=</span><span class="dv">40</span>),</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>, showticklabels<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>, showticklabels<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>        plot_bgcolor<span class="op">=</span><span class="st">"white"</span>,  </span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>        paper_bgcolor<span class="op">=</span><span class="st">"white"</span>  </span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the graph</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can call our plotting function with our CSV and minimum shared actors by running the following:</p>
<div id="8392ca9a-8deb-4ce4-97e0-5007bb093330" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> generate_movie_actor_network(csv_file <span class="op">=</span> <span class="st">"results.csv"</span>, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                                   min_shared_actors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe scrolling="no" width="100%" height="545px" src="iframe_figures/figure_12.html" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
</section>
<section id="interpretting-the-visualization" class="level3">
<h3 class="anchored" data-anchor-id="interpretting-the-visualization">Interpretting the Visualization</h3>
<p>By analyzing the graph, we can identify:</p>
<ul>
<li>Highly interconnected movies: Franchises and sequels (e.g., Harry Potter Series) tend to cluster together.</li>
<li>Unexpected connections: Some movies share actors despite belonging to different genres.</li>
<li>Strongest recommendations: The best recommendations are movies that share the most actors with the chosen starting movie.</li>
</ul>
<p>This approach demonstrates how web scraping and network analysis can be combined to generate meaningful movie recommendations based purely on cast overlap, without using machine learning.</p>
<p><strong>Resources Used (For NetworkX Visualization):</strong><br></p>
<ul>
<li>https://plotly.com/python/network-graphs/</li>
<li>https://community.plotly.com/t/is-plotly-able-to-integrate-with-networkx-graph/59115</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>